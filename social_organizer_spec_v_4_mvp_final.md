# Социальный организер — спецификация для разработки (MVP, v4 FINAL)

> **Статус:** окончательная версия MVP для реализации и кодогенерации.
>
> Документ описывает **ТОЛЬКО реализуемую логику MVP**. Все будущие механики вынесены за пределы области действия.

---

## Общее описание

Социальный организер — это инструмент социальной координации, который помогает людям быстро и прозрачно координироваться, когда кому-то нужна помощь.

Он:
- рассылает уведомления людям,
- фиксирует, кто откликнулся и на какую сумму,
- показывает, сколько уже заявлено,
- хранит полную историю всех действий.

Организер **не переводит деньги**, **не подтверждает фактическую помощь**, **не решает споры** и **не вмешивается в отношения людей**.

Все реальные действия (переводы, договорённости, исполнение) происходят **вне системы** — в чате между людьми.

> **Важно:** приложение — только инструмент социальной координации («социальный органайзер»), а не финансовый сервис.

---

## Scope документа (жёсткая фиксация)

### ВХОДИТ В MVP:
- единый референтный список пользователей;
- уведомления о сборах;
- создание сборов (экстренные и регулярные);
- **одна сущность — commitment**;
- статистика фактов участия.

### НЕ ВХОДИТ В MVP (OUT OF SCOPE):
- инициативы кооперации;
- cooperation requests;
- коллективные действия вне сборов;
- подтверждение фактического исполнения обязательств;
- арбитраж, споры, санкции.

Все перечисленные механики выносятся в **отдельный документ (vNext)** и **не реализуются** в MVP.

---

## Терминология (обязательная)

- **User** — участник системы.
- **Link** — эмпатическая связь между двумя пользователями (взаимно подтверждённая).
- **Handshake path** — цепочка рукопожатий между пользователями.
- **Case (Сбор)** — запрос о помощи (экстренный или регулярный).
- **Commitment** — запись «я готов помочь на X».
- **Notification** — внутреннее уведомление в системе.
- **Chat link** — внешняя ссылка на чат (Telegram / WhatsApp / Discord и т.д.).

### Запрещённые термины
В коде и документации **НЕ используются**:
- obligation
- pledge
- intent
- promise

Используется **ТОЛЬКО** `commitment`.

---

## Фундаментальные принципы

### Связи (Links) — MVP

Связь — это **эмпатическая P2P-связь между двумя пользователями**, формируемая **только при взаимном подтверждении**.

Механика связей (MVP):
- у каждого пользователя **150 слотов связей**;
- связь создаётся только при **обоюдном согласии**;
- каждая связь занимает **1 слот у каждого**;
- связь **необратима** и не может быть удалена вручную;
- **единственное исключение** — удаление аккаунта одним из пользователей (слот освобождается у всех его связей).

Связи формируют **эмпатический граф**, используемый для определения рассылки уведомлений.

---

### Референтный список

Референтный список — это **единый реестр всех участников системы**, формируемый через **наследуемость связей**.

Каждый новый участник, подтверждая инвайт, наследует все связи пригласившего.

В результате:
- все участники видят **один и тот же список пользователей**;
- нет «моего» и «твоего» реестра — он **общий для всех**;
- различие между пользователями — только в **числе рукопожатий**.

### Рукопожатия

Рукопожатия — это **справочная метаинформация**, которая показывает:
- через кого пользователь связан с другим;
- сколько шагов между ними;
- конкретный путь (A → B → C).

Рукопожатия **не ограничивают доступ**, а лишь дают прозрачность.

---

## Ключевое различие: реестр vs рассылка

- **Реестр пользователей — общий и доступен всем.**
- **Рассылка уведомлений — локальная.**

Это принципиально разные вещи.

> **Формула:**
> - Реестр = полный граф (структурный).
> - Рассылка = локальная активация графа (event-driven).

---

## Commitment (единая сущность)

В системе существует **только один тип обязательства — commitment**.

У commitment **нет состояний** «выполнен / не выполнен» в MVP.

Commitment фиксирует **ТОЛЬКО факт**:
- пользователь заявил готовность помочь на сумму X;
- пользователю была открыта ссылка на чат.

Фактическое исполнение находится **полностью вне системы**.

---

## Типы сборов (cases)

Существует **два и только два типа сборов**:
- **Emergency** — экстренный (разовый);
- **Regular** — регулярный (ежемесячный).

Тип задаётся полем `caseType`.

---

## Экстренный сбор

### Создание

Создатель указывает **только**:
- сумму;
- валюту (USD или EUR);
- ссылку на внешний чат.

Минимальная сумма сбора — **10 единиц**.

> **Лимиты (MVP):**
> Пользователь может иметь одновременно **не более одного активного экстренного** сбора.

---

### Кого уведомляют

Количество уведомляемых = **сумма сбора ÷ 10**.

Пример:
- запрос 5 000 → уведомляется 500 человек.

Рассылка:
- происходит **одномоментно**;
- начинается с прямых связей (1-е рукопожатие);
- затем 2-е, 3-е и т.д.;
- пока не будет набрано нужное количество.

Если человек получил уведомление — **повторного не будет**.

> **Правило новых пользователей (MVP):**
> Пользователи, зарегистрировавшиеся после создания сбора, **не получают уведомления** о нём.

---

### Действия пользователя

Получив уведомление, пользователь может:

1. **Взять commitment**:
   - указать сумму ≥ 10;
   - после этого считается участником сбора;
   - ему открывается ссылка на чат.

2. **Закрыть уведомление** — отказаться от участия.

3. **Ничего не делать** — через 24 часа уведомление исчезает.

Все действия и бездействия фиксируются.

---

### Блокировка и закрытие сбора (MVP)

**Блокировка:**
- когда сумма commitments ≥ цели сбора,
- система **автоматически блокирует** возможность новых commitments;
- доуведомления прекращаются.

**Закрытие:**
- выполняется **ТОЛЬКО вручную создателем**;
- при закрытии:
  - сбор уходит в архив;
  - **все пользователи, взявшие commitment, считаются исполнившими обязательства**;
  - записи попадают в статистику.

> **Важно:**
> В MVP **НЕ СУЩЕСТВУЕТ** понятия «невыполненное обязательство».
> Система не различает фактическое исполнение.

---

### Доуведомление (MVP)

Пока сбор:
- не заблокирован,
- не закрыт,

система каждые **12 часов** проверяет прогресс.

Если есть недобор:
- рассчитывается `недобор ÷ 10`;
- отправляются уведомления **только новым людям**, ранее не получавшим уведомление о данном сборе;
- рассылка продолжается дальше по графу связей.

Доуведомление прекращается при блокировке или закрытии сбора.

---

## Регулярный сбор

> **Лимиты (MVP):**
> Пользователь может иметь одновременно **не более одного активного регулярного** сбора.

- цикл — **28 дней**;
- старт каждого цикла — **1-е число месяца**;
- уведомление рассылается **один раз при создании**;
- участники автоматически считаются вписанными каждый цикл;
- цикл закрывается автоматически;
- все commitments записываются в статистику.

Подтверждения исполнения **нет**.

---

## Статистика

Статистика фиксирует **факты участия**, а не реальное исполнение:
- количество сборов, в которых участвовал;
- общую сумму заявленных commitments (по валютам);
- кому помогал;
- сколько раз создавал сборы;
- сколько раз получал помощь.

Статистика **не является рейтингом** и не содержит оценок.

---

## Игнор (P2P-блокировка коммуникации)

Игнор — это **локальная P2P-блокировка коммуникации между двумя пользователями**.

Механика игнора (MVP):
- если пользователь A добавил пользователя B в игнор:
  - A **не получает** уведомления о сборах, созданных B;
  - B **не получает** уведомления о сборах, созданных A;
- игнор **двусторонний по эффекту**, но **односторонний по действию** (каждый управляет своим списком);
- игнор **не влияет** на:
  - видимость профилей;
  - историю и статистику;
  - существующие связи (link не удаляется);
- игнор можно снять в любой момент.

Игнор — это не санкция и не наказание, а **личное право пользователя ограничить P2P-коммуникацию**.

---

## Чего в системе нет

В MVP отсутствуют:
- деньги;
- переводы;
- рейтинги;
- подтверждение оплаты;
- санкции;
- арбитраж;
- напоминания;
- давление на пользователя.

Система только **передаёт сигнал и фиксирует факты**.

---

## Итоговая формула MVP

- Один реестр — для всех.
- Одна сущность — commitment.
- Уведомление — один раз.
- Закрытие — только создателем.
- Закрыл → все commitments считаются исполненными.
- Всё остальное — вне системы.

**Это социальный органайзер, а не контрольный механизм.**

