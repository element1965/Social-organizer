# Социальный организер — спецификация для разработки

## Общее описание

Социальный организер — это инструмент, который помогает людям быстро и прозрачно координироваться, когда кому-то нужна помощь.

Он:
- рассылает уведомления людям,
- фиксирует, кто откликнулся и на какую сумму,
- показывает, сколько уже собрано,
- хранит полную историю всех действий.

Организер не переводит деньги, не решает споры и не вмешивается в отношения людей.
Все реальные действия происходят вне системы.

> **Уточнение:** Приложение — только инструмент координации («социальный органайзер»). Создатель сбора является получателем помощи, но вся реальная помощь (переводы, действия) происходит за пределами приложения.

### Архитектура

> **Решение:** Гибридная архитектура — P2P (Gun.js) + серверная часть для фоновых задач.
>
> - **P2P (Gun.js)** — для децентрализации данных. Система должна быть «неубиваемой», данные не зависят от одного сервера.
> - **Серверная часть (Railway, MVP)** — фоновые задачи: таймеры 24ч на уведомления, автозакрытие сборов при достижении суммы, ежемесячные напоминания для регулярных сборов.
> - **Масштабирование:** при экспоненциальном росте — бэкапы в торрент, чтобы данные были неуничтожимы.
> - **Публикация:**
>   - Основная платформа: **Facebook Gaming** (instant game). Приложение должно быть максимально безобидным, не нарушать правил FB Gaming, гарантированно пройти модерацию.
>   - Зеркало: **GitHub Pages**.
> - **Позиционирование для модерации:** социальный организационный инструмент, а не финансовый сервис. Никаких денежных операций внутри системы.

---

## 1. Что такое уведомление

Уведомление — это персональное сообщение пользователю внутри системы.
Оно выглядит как сообщение в мессенджере:
- загорается колокольчик,
- пользователь открывает и видит текст.

Текст уведомления:
- Экстренный сбор: **«Запрос о срочной помощи в сумме [сумма] [валюта] от [Имя]»**
- Регулярный сбор: **«Запрос о регулярной помощи в сумме [сумма] [валюта] от [Имя]»**
- Закрытие сбора: **«Сбор закрыт»**
- Закрытие с недобором: **«Сбор закрыт с недобором в [сумма] [валюта]»**

Уведомление приходит один раз.
Никаких повторов и напоминаний не бывает.

---

## 2. Экстренная помощь (разовый сбор)

### 2.1 Создание запроса

Пользователь нажимает кнопку «Мне нужна помощь» и указывает:
- сумму, которая нужна (например, 5 000),
- валюту (₽, $, € и т.д.),
- ссылку на внешний чат (где потом всё обсуждается).

> **Уточнение:** Только эти три поля. Никаких дополнительных полей (описание, причина и т.д.) — всё обсуждается за пределами системы, в чате.
> Валюта указывается создателем сбора, чтобы люди из других стран видели сколько нужно в **его** валюте. Система валюту только отображает — не конвертирует, не обрабатывает, не хранит деньги.

После этого начинается сбор.

> **Уточнение — лимит сборов:** Пользователь может иметь одновременно максимум **1 экстренный** и **1 регулярный** сбор. Других комбинаций нет (нельзя 2 экстренных или 2 регулярных одновременно).
>
> **Минимальная сумма сбора:** для любого типа сбора (экстренный или регулярный) — **10 единиц** в выбранной валюте.
>
> **Предупреждение при большой сумме:** Если сумма сбора превышает **10 000**, создатель получает предупреждение перед подтверждением: «Вам действительно жизненно важно собрать такую сумму? Вы потревожите [N] человек». Создатель должен осознанно подтвердить. Лимита на максимальную сумму нет.

### 2.2 Кого уведомляют

Организер сразу и одновременно уведомляет ограниченное количество людей, равное сумме запроса в единицах.

Пример:
- сумма запроса: 5 000
- значит уведомляется 5 000 человек

Кто именно уведомляется:
- сначала люди, которых лично добавил запросивший,
- затем люди, которых добавили они,
- дальше — по цепочке связей.

> **Уточнение:** Связь **односторонняя**. A добавляет B — это значит A знает B. B не обязан добавлять A в ответ.
> При обходе цепочки для рассылки уведомлений связи работают **во все стороны**: учитываются как исходящие (кого добавил A), так и входящие (кто добавил A). Граф связей — ненаправленный для целей рассылки.
> **Лимит 150 связей — навсегда и необратимо.** Это круг людей, с кем есть реальные эмпатические связи. Пользователь может начать хоть с **1 связи**, добавлять постепенно до 150. Но добавленного человека убрать нельзя, и больше 150 — нельзя.

Если человек получил уведомление — это его единственный шанс участвовать.

> **Уточнение:** Если в цепочке связей доступно меньше людей, чем сумма — сбор всё равно создаётся, уведомляются все доступные. Далее действует механизм доуведомления (см. 2.7).

### 2.3 Что может сделать пользователь

Получив уведомление, пользователь может:

**Взять обязательство:**
- записать сумму (минимум 1, максимум — сколько хочет) — это сумма в валюте, указанной создателем сбора,
- после этого он считается участником сбора,
- ему открывается ссылка на чат.

> **Уточнение:** Обязательство **необратимо**. После ввода суммы пользователь обязан выполнить его хотя бы на минимальную единицу (1) в валюте сбора. Отменить или уменьшить обязательство нельзя.

> **Уточнение:** До ввода суммы пользователь видит только сумму сбора и цепочку связей («рукопожатия» — кто кого знает). Ссылка на чат **скрыта** до тех пор, пока пользователь не изъявит желание помочь, введя сумму от 1 и более.

**Закрыть уведомление:**
- это означает, что он не готов участвовать,
- повторного уведомления не будет.

**Ничего не делать:**
- через 24 часа уведомление исчезает само.

Во всех случаях факт действия (или бездействия) сохраняется в истории.

### 2.4 Что видит пользователь, который участвует

Если пользователь ввёл сумму:
- он видит общий сбор,
- видит, сколько уже собрано,
- видит, сколько ещё не хватает,
- видит, что сбор идёт в реальном времени.

Дальше он переходит в чат и там узнаёт:
- что случилось,
- как именно помочь,
- как передать деньги.

### 2.5 Что фиксирует система

> **Уточнение:** Кнопок «Я выполнил обязательство» и «Подтвердить факт помощи» — **нет**. Система фиксирует только:
> - факт, что участник вписал сумму,
> - факт, что ему открылась ссылка на чат.
>
> Дальше всё происходит за пределами системы. Система не отслеживает, помог ли человек реально.
> Создатель сбора сам решает, когда закрыть сбор вручную (см. 2.7).

Никаких споров, отказов, объяснений или арбитражей в системе не существует.
Организер ничего не решает — он только фиксирует факты.

### 2.7 Закрытие сбора и доуведомление

Закрытие сбора — **двухэтапный процесс:**

**Этап 1 — Блокировка:** Когда сумма обязательств ≥ сумма сбора — система **блокирует** возможность вписаться для остальных уведомлённых. Доуведомления прекращаются. Но сбор ещё **не закрыт**.

**Этап 2 — Закрытие:** Создатель сбора **вручную закрывает** сбор после того, как физически получил помощь. Только после этого:
- сбор считается закрытым,
- **все ранее уведомлённые** (и кто вписался, и кто не успел) получают уведомление: «Сбор закрыт».

Это просто факт, без благодарностей и комментариев.

> **Уточнение:** Если кто-то из участников не выполняет обязательство после блокировки — сбор не «переоткрывается» автоматически. Создатель **не может разблокировать** сбор. Невыполненные обязательства висят в профилях участников и видны всем. Создатель сам решает, закрывать сбор или нет.
>
> **Досрочное закрытие:** Создатель может закрыть экстренный сбор **вручную в любой момент**, даже если сумма не набрана. В этом случае все, кто заявил о готовности помочь, получают запись в статистику как **участвовавшие** (каждый — на свою заявленную сумму).
>
> **Таймаута на закрытие нет.** Создатель может не закрывать сбор сколько угодно после блокировки. Но пока сбор не закрыт — участникам **не зачтётся** помощь в статистику. Это мотивирует создателя закрыть сбор.

> **Уточнение — механизм доуведомления:**
> Каждые **12 часов**, пока сбор не закрыт, система проверяет: собрана ли нужная сумма?
> - Если нет — отправляются дополнительные уведомления **только новым людям** (не получавшим уведомление о данном сборе), дальше по сферам связей.
> - Количество доуведомлений = количество ещё не собранных единиц.
> - Пример: запрос 5 000, за 12ч собрано 4 000 → отправляется ещё 1 000 уведомлений.
> - Цикл повторяется каждые 12 часов, пока сбор не закрыт.
> - Если люди в цепочке связей закончились — **все новые пользователи**, регистрирующиеся в системе, автоматически получают уведомление об этом сборе.
> - Сбор **не имеет таймаута** — висит, пока не наберётся нужная сумма.
>
> Если сбор закрылся — все, кто получал уведомление о сборе, получают уведомление о его закрытии.

---

## 3. Регулярная помощь (ежемесячная)

### 3.1 Создание регулярного сбора

Пользователь может создать регулярный сбор, например:
«Мне нужно 2 000 в месяц».

Он указывает:
- сумму,
- валюту,
- ссылку на чат.

### 3.2 Стартовое уведомление

Организер один раз рассылает уведомления на нужное количество людей.
Дальше организер не расширяет рассылку.

Пользователь сам может:
- отправлять ссылку знакомым,
- привлекать людей напрямую.

### 3.3 Подписка

Если человек согласился:
- он оформляет регулярное обязательство,
- оно выполняется раз в месяц (например, 1 числа).

Каждый месяц:
- организер напоминает участникам,
- участники помогают вне системы,
- отмечают выполнение.

> **Уточнение:**
> - Напоминаний для регулярных сборов **нет**. Уведомление приходит **один раз** — при создании сбора.
> - Участники, которые подписались, **автоматически** считаются вписавшимися на ту же сумму каждый месяц. Заново вписывать не нужно.
> - Месячный цикл регулярного сбора **закрывается автоматически** (независимо от результата). Создателю не нужно закрывать вручную каждый месяц.
> - При закрытии цикла все вписавшиеся получают себе в **статистику** запись о помощи инициатору (каждый — на заявленную сумму).
> - Цикл регулярного сбора — **28 дней** (не календарный месяц).
> - Если сумма не собрана — все участники получают уведомление: «Сбор закрыт с недобором в [сумма] [валюта]».
> - Система не отслеживает фактическое выполнение (как и в экстренном сборе). Всё решается в чате за пределами системы.
> - Участник может **отписаться** от регулярного обязательства в любой момент.

> **Уточнение:**
> - Регулярное обязательство выполняется **всегда 1-го числа** каждого месяца. Дата не настраивается.
> - Создатель регулярного сбора может **прекратить** его в любой момент.

---

## Главный экран (дашборд)

При открытии приложения пользователь видит:

**Уведомления (колокольчик):**
- Счётчик непрочитанных уведомлений. При нажатии — список входящих запросов о помощи.

**Мои сборы:**
- Мой экстренный сбор (если есть): сумма, валюта, прогресс (собрано / цель), статус (активен / заблокирован).
- Мой регулярный сбор (если есть): сумма, валюта, количество подписчиков, статус текущего месяца.
- Кнопка «Мне нужна помощь» (если нет активного сбора данного типа).

**Мои обязательства:**
- Список сборов, в которых я участвую (вписал сумму): название сбора, сумма моего обязательства, статус сбора.

**Моя сеть:**
- Количество связей (из 150).
- Кнопка перехода к профилю / списку связей.

**Статистика в профиле:**
- Сколько раз помогал (количество сборов).
- На какую общую сумму (по каждой валюте отдельно).
- Кому помогал (список).
- Сколько раз создавал сборы.
- Сколько получил помощи (общая сумма).

---

## 4. История и открытость

### 4.1 Что хранится в системе

Система хранит всю активность:
- кто кого пригласил,
- кому и когда пришло уведомление,
- кто участвовал,
- кто сколько обязался,
- кто выполнил обязательства,
- когда сборы открывались и закрывались.

Ничего не удаляется.

### 4.2 Публичность

В профиле каждого пользователя видно:
- все его обязательства,
- суммы,
- кому и когда он помогал,
- историю его участия,
- его связи («рукопожатия»).

Реестр не анонимный.
Все пользователи — реальные, подтверждённые людьми, которые их знают.

> **Уточнение:** Профиль **публичный** — его видят все пользователи системы, включая связи («рукопожатия»). Любой пользователь может зайти на профиль любого другого человека в системе.

> **Уточнение — вход в систему (MVP):**
> - Приложение стартует на **Facebook** (формат уточняется — см. открытые вопросы).
> - Пользователь хочет видеть **всех своих FB-друзей** и выбрать из них до **150 человек** как свои связи.
> - Также может отправить **персональную пригласительную ссылку** кому угодно.
> - MVP только с Facebook. Мобильное приложение — следующий этап.

---

## 5. Чего в системе нет

В системе нет:
- денег,
- переводов,
- рейтингов,
- наказаний,
- арбитражей,
- повторных уведомлений,
- давления на пользователя.

Организер — это инструмент координации, а не контроля.

> **Уточнение — игнор-лист:** Пользователь может добавить другого участника в **личный игнор**. Это означает:
> - он не получает уведомления о сборах этого участника,
> - этот участник не получает уведомления о его сборах.
> Игнор двусторонний по эффекту, но приватный — другие пользователи не видят чужие игнор-листы.
> Игнор **можно снять** в любой момент.

---

## 6. Ключевая логика (коротко)

- Уведомление приходит один раз.
- Либо участвуешь, либо нет.
- Никаких напоминаний.
- Никаких оправданий.
- Вся история сохраняется.
- Все решения принимают люди, не система.

> **Уточнение — интерфейс:**
> UI мультиязычный — **25 самых используемых языков** с момента запуска.

---

## Открытые вопросы

### OQ-1: Формат Facebook-приложения и доступ к друзьям

**Проблема:** Пользователь хочет видеть всех своих FB-друзей в приложении, чтобы выбрать 150 связей. Но:
- **Facebook Instant Games API** (`getConnectedPlayersAsync`) возвращает только друзей, **уже играющих в это приложение** (за 90 дней). Полный список друзей недоступен.
- **Graph API** `/me/friends` возвращает только друзей, **давших разрешение этому приложению**. Полный список тоже недоступен.
- С 1 августа 2025 Meta ввела **Zero Permissions (NEZP)** — ещё больше ограничивает данные.
- **Web Games на Facebook закрываются к 30 сентября 2026.**

**Решение:** Используем **Facebook Instant Game** с `FBInstant.context.chooseAsync()` — стандартный диалог Meta для выбора друзей/приглашения. Дополнительно — персональные ссылки-приглашения.

**Остаётся уточнить:**
- Достаточно ли chooseAsync для выбора 150 связей (диалог может иметь лимиты)?
- Как именно показывать связи в UI, если полные данные друзей (имена, фото) ограничены NEZP?
- Web Games на FB закрываются к 30.09.2026 — нужен план миграции.

**Статус:** частично решён.
